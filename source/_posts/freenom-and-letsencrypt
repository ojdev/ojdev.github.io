---
title: Freenow申请的域名申请letsencrypt证书的方法
date: 2022-12-23 14:24:02
updated:  2022-12-23 14:24:02
mermaid: true
categories:
- 知识储备
tags:
 - Freenom
 - SSL证书
 - letsencrypt
 - 免费顶级域名
---


freenow申请的域名，直接使用进行`cloudflare`解析是可以的，但是申请证书的时候却无法直接使用`certbot/dns-cloudflare`选择dns的方式直接通过api申请和续期。
```
Saving debug log to /var/log/letsencrypt/letsencrypt.log

How would you like to authenticate with the ACME CA?
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
1: Obtain certificates using a DNS TXT record (if you are using Cloudflare for
DNS). (dns-cloudflare)
2: Spin up a temporary webserver (standalone)
3: Place files in webroot directory (webroot)
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Select the appropriate number [1-3] then [enter] (press 'c' to cancel): 1
Requesting a certificate for *.****.**
Encountered CloudFlareAPIError adding TXT record: 1038 You cannot use this API for domains with a .cf, .ga, .gq, .ml, or .tk TLD (top-level domain). To configure the DNS settings for this domain, use the Cloudflare Dashboard.
Error communicating with the Cloudflare API: You cannot use this API for domains with a .cf, .ga, .gq, .ml, or .tk TLD (top-level domain). To configure the DNS settings for this domain, use the Cloudflare Dashboard.
Ask for help or search for solutions at https://community.letsencrypt.org. See the logfile /var/log/letsencrypt/letsencrypt.log or re-run Certbot with -v for more details.
```

只能通过手动添加txt解析记录的方式进行证书申请。

我选择了使用acme的申请方式进行申请，但是依然无法做到全自动，因为上面提到了，cloudflare的api不能对`.cf, .ga, .gq, .ml, or .tk TLD (top-level domain).`顶级域名进行api申请。

由于不喜欢在服务器上安装东西，所以还是采用docker的方式。

# 第一步：拉取镜像

```
docker pull neilpang/acme.sh:latest
```

# 第二步：后台启动

```
docker run --rm -itd -v "$(pwd)/out":/acme.sh --net=host --name=acme.sh neilpang/acme.sh daemon
```

# 第三步：设置默认服务
```
docker exec acme.sh --set-default-ca --server letsencrypt
```

# 第四步：根据提示到cloudflare添加TXT解析

```
docker exec acme.sh --issue --dns -d 域名1 -d 域名2 -d 域名n --yes-I-know-dns-manual-mode-enough-go-ahead-please
```

# 第五步：申请证书

这里要注意，下面是--renew参数，不是--issue，且后面的域名是第四步中添加了TXT解析的域名

```
docker exec acme.sh --renew -d 域名1 -d 域名2 -d 域名n --yes-I-know-dns-manual-mode-enough-go-ahead-please --key-file /acme.sh/letsencrypt/域名.key --fullchain-file /acme.sh/letsencrypt/域名.pem
```

# 其他

不能申请泛域名证书
