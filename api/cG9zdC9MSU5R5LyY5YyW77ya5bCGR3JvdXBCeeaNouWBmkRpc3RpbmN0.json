{"title":"LINQ优化：将GroupBy换做Distinct","date":"2011-05-06T10:23:18.000Z","slug":"LINQ优化：将GroupBy换做Distinct","updated":"2019-05-22T09:46:50.169Z","content":"<p>这样做也是没有办法的，我之前项目中，查询中这样写的分组</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">form t <span class=\"keyword\">in</span> db.Table</span><br><span class=\"line\"><span class=\"keyword\">where</span> t.state==<span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"keyword\">group</span> t <span class=\"keyword\">by</span> <span class=\"keyword\">new</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">   t.A,</span><br><span class=\"line\">   t.B,</span><br><span class=\"line\">   t.C</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">into</span> p</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">new</span>&#123;</span><br><span class=\"line\">   ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>导致的就是，数据表中不到1W行数据，经过分组后是752行，但是第一次查询要将近10秒。</p>\n<p>这太不能容忍了，所以思来想去，只有更换为Distinct来解决。</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(form t <span class=\"keyword\">in</span> db.Table</span><br><span class=\"line\"><span class=\"keyword\">where</span> t.state==<span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">new</span>&#123;</span><br><span class=\"line\">   ...</span><br><span class=\"line\">&#125;).Distinct();</span><br></pre></td></tr></table></figure>\n<p>感觉很好，不到1秒，只是微软对Distinct的支持不是很好，因为这个去重靠的是每个对象的比对，对象相同则去重，而无法对某一个字段去重，很遗憾。</p>\n","prev":{"title":"C#与盗梦空间-我们要进入下一层梦境","slug":"C-与盗梦空间-我们要进入下一层梦境"},"next":{"title":"关于数据容量","slug":"关于数据容量"},"link":"http://ojdev.github.io/post/LINQ优化：将GroupBy换做Distinct/"}