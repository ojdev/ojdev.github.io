{"title":"k8s的环境搭建","date":"2019-06-03T09:31:00.000Z","slug":"kubernetes-for-debian","tags":["k8s,debian9"],"updated":"2019-06-03T10:34:38.439Z","content":"<p>依然是模拟环境，使用windows10的hyperV。</p>\n<p>在虚拟机中安装debian9，只要核心的那种，开openssh的。</p>\n<p>更新debian<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt update</span><br><span class=\"line\">apt upgrade -y</span><br></pre></td></tr></table></figure></p>\n<p>关闭交换内存</p>\n<blockquote>\n<p>kubernetes 的想法是将实例紧密包装到尽可能接近100％。 所有的部署应该与 CPU 和内存限制固定在一起。 所以如果调度程序发送一个 pod 到一台机器，它不应该使用交换，设计者不想交换，因为它会减慢速度，所以关闭 swap 主要是为了性能考虑。当然为了一些节省资源的场景，比如运行容器数量较多，可添加 kubelet 参数 –fail-swap-on=false 来解决。</p>\n</blockquote>\n<p>然后安装<a href=\"https://opsx.alibaba.com/mirror?lang=zh-CN\" target=\"_blank\" rel=\"noopener\">k8s的aliyun源</a><br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get update &amp;&amp; apt-get install -y apt-transport-https</span><br><span class=\"line\">curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add - </span><br><span class=\"line\">cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list</span><br><span class=\"line\">deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main</span><br><span class=\"line\">EOF  </span><br><span class=\"line\">apt-get update</span><br><span class=\"line\">apt-get install -y kubelet kubeadm kubectl</span><br><span class=\"line\">apt-mark hold kubelet kubeadm kubectl</span><br></pre></td></tr></table></figure></p>\n<p>添加docker源</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -fsSL https://download.docker.com/linux/debian/gpg | apt-key add -</span><br><span class=\"line\"></span><br><span class=\"line\">cat &lt;&lt;EOF&gt;/etc/apt/sources.list.d/docker.list</span><br><span class=\"line\">deb [arch=amd64] https://download.docker.com/linux/debian stretch stable</span><br><span class=\"line\">EOF</span><br><span class=\"line\">apt update</span><br><span class=\"line\">apt install -y docker-ce</span><br></pre></td></tr></table></figure>\n<p>添加docker的aliyun镜像源<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &lt;&lt;EOF&gt;/etc/docker/daemon.json</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    \"registry-mirrors\": [\"https://********.mirror.aliyuncs.com\"],</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">EOF</span><br><span class=\"line\">mkdir -p /etc/systemd/system/docker.service.d</span><br><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\">systemctl restart docker</span><br><span class=\"line\">systemctl enable docker</span><br></pre></td></tr></table></figure></p>\n<p>重启系统，让所有配置生效。</p>\n","next":{"title":"在windows上创建kubernetes集群","slug":"kubernetes"},"link":"http://ojdev.github.io/post/kubernetes-for-debian/"}